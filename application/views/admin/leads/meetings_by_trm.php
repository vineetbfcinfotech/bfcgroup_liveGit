<?php init_head(); ?><div id="wrapper"><?php init_clockinout(); ?>    <div class="content">        <div class="row">            <div class="col-md-12">                <div class="panel_s">                    <div class="panel-body">                        <center><h3>Meetings By TRM's</h3></center>                        <hr>                        <div class="row"> <center>                            <select id="trmfilter" multiple data-none-selected-text="Filter By TRM"                                        data-live-search="true" class="selectpicker custom_lead_filter">                                    <?php if (!empty($alltrms)) {                                        foreach ($alltrms as $trm) { ?>                                            <option value="<?= $trm->assigned_by; ?>"><?= $trm->trmname; ?></option>                                        <?php }                                    } ?>                            </select>                                                        <select id="meetingfilter" multiple data-none-selected-text="Filter By Assigned Meetings"                                        data-live-search="true" class="selectpicker custom_lead_filter">                                    <option value="0"> Unassigned Meetings</option>                                    <option value="1"> Assigned Meetings</option>                                                                   </select>                          </center>                          </div>                        <div class="clear-fix"></div>                        <table class="table dt-table scroll-responsive">                               <thead>                               <th><?php echo _l('Sr.no'); ?></th>                               <th><?php echo "TRM Name"; ?></th>                               <th><?php echo "Name"; ?></th>                               <th><?php echo "Address"; ?></th>                               <th><?php echo "Meeting Time"; ?></th>                               <th><?php echo "Working Person"; ?></th>                               </thead>                               <tbody class="ajax-data">                               <?php if ( !empty($getLeads) ) {                                  foreach ($getLeads as $lead) { ?>                                      <tr>                                          <td><?= @++$i; ?></td>                                          <td><?= $lead->fullname; ?></td>                                          <td><?= $lead->name; ?></td>                                          <td><?= $lead->address; ?></td>                                          <td><? $date = date_create($lead->meetingtimefrom); echo date_format($date, 'g:ia'); ?> - <? $date = date_create($lead->meetingtimeto); echo date_format($date, 'g:ia \o\n l jS F Y'); ?></td>                                          <td>                                                                                                                                         <?php                                                $this->db->select('tblmeeting_scheduled.*,CONCAT(tblstaff.firstname, " ", tblstaff.lastname) AS  wpname');                                                $this->db->where('lead_id', $lead->id);                                                $this->db->join('tblstaff', 'tblmeeting_scheduled.assigned=tblstaff.staffid');                                                $query = $this->db->get('tblmeeting_scheduled');                                                $q2 = $query->result();                                                $aswp = $query->num_rows();                                                if ($aswp > 0) {                                                    $asgndwp = $q2['0']->assigned;                                                    $wpname = $q2['0']->wpname;                                                } else {                                                    $asgndwp = "0";                                                    $wpname = "";                                                }                                                ?>                                                <? if (is_admin() || is_headtrm())                                                { ?>                                                   <select data-lead_id="<?= $lead->id; ?>" data-staffid="<?= $lead->assigned; ?>"  id="working_person" name="working_person" class="selectpicker" data-width="100%" data-none-selected-text="Nothing selected" data-live-search="true" tabindex="-98">                                              <option  value=""></option>                                              <? foreach($availwp as $wp) { ?>                                              <option <? if($asgndwp == $wp[staffid] ) { echo "selected"; } ?> value="<?= $wp[staffid]; ?>"><?= $wp[firstname]; ?></option>                                              <? } ?>                                          </select>                                                                                        <?  }                                               else {                                                  echo $wpname;                                              }                                                                                             ?>                                                                                     </td>                                      </tr>                                  <?php }                               } ?>                               </tbody>                           </table>                    </div>                </div>            </div>        </div>    </div></div><?php init_tail(); ?><script>  $(document).ready(function(){       $('select[name=working_person]').on('change', function() {                const  lead_id = $(this).data('lead_id');                       staffid = $(this).data('staffid');                        wp_id = $(this).val();                                                                         url = "<?= base_url('admin/leads/assign_wp_on_lead') ?>";        $.get(url, {                lead_id: lead_id,                staffid: staffid,                wp_id: wp_id            } ,                                   function (data) {                 alert_float('success', 'Meeting Assigned Successfully');                $('.lightboxOverlay').html(res);            })                        });    });          $(document).on('change', '.custom_lead_filter', function () {        const trmfilter = $('#trmfilter').val(),              meetingfilter = $('#meetingfilter').val(),              url = "<?= base_url('admin/leads/filter_meetings_by_trm') ?>";                         if(trmfilter == "" && meetingfilter == "")        {                        location.reload();        }                                           $('.ajax-data').html("<center> <img src='http://www.itgeared.com/demo/images/loading.gif' style='width:100%'></center>");            $.get(url, {                trmfilter: trmfilter,                meetingfilter: meetingfilter            },            function (res) {                $('.ajax-data').html(res);            })    });</script></body></html>